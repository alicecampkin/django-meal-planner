{% extends 'core/base.html' %}



{% block content %}

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>
<script src="https://unpkg.com/dayjs@1.8.21/plugin/utc.js"></script>
<script>dayjs.extend(window.dayjs_plugin_utc)</script>


<div id="app" class="row">

    <div class="col">
        {% include 'partials/addmeal.html' %}
    </div>

    <div class="col">
        <button v-on:click="page -= 1" class="btn btn-outline-secondary">Prev</button>
        <button v-on:click="page = 0" class="btn btn-outline-secondary">Today</button>
        <button v-on:click="page += 1" class="btn btn-outline-secondary">Next</button>

        <button v-on:click="mealTime = 'Breakfast'" class="btn btn-sm btn-info">Breakfast</button>
        <button v-on:click="mealTime = 'Lunch'" class="btn btn-sm btn-info">Lunch</button>
        <button v-on:click="mealTime = 'Dinner'" class="btn btn-sm btn-info">Dinner</button>

        <article v-for="day in schedule" class="datecard" v-on:click="formDate = day.dateForForm">
            <h5>[[day.date]]</h5>

            <section v-if="mealTime == 'Breakfast'">
                <h6>Breakfast</h6>
                <li v-for="breakfast in day.breakfasts">
                    [[breakfast.name]]
                </li>
            </section>

            <section v-if="mealTime == 'Lunch'">
                <h6>Lunch</h6>
                <li v-for="lunch in day.lunches">
                    [[lunch.name]]
                </li>
            </section>

            <section v-if="mealTime == 'Dinner'">
                <h6>Dinner</h6>
                <li v-for="dinner in day.dinners">
                    [[dinner.name]]
                </li>
            </section>

        </article>
    </div>





</div>


<script>

    const meals = JSON.parse(`{{ meals| safe }}`)
    const defaultMealtime = `{{ default_mealtime | safe}}`
    console.log(meals)

    var app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',

        data: {
            meals: meals,
            daysPerPage: 7,
            page: 0,
            formDate: null,
            formMealTime: '',
            formMeal: null,
            showMeals: true,
            mealTime: defaultMealtime,
        },

        methods: {
            greet: function (name) {
                this.daysPerPage = 6
                console.log(this.daysPerPage)
            }

        },

        computed: {

            dates: function () {
                const day = dayjs()
                const pageStart = this.page * this.daysPerPage
                const pageEnd = pageStart + this.daysPerPage

                const dates = []

                for (let i = pageStart; i < pageEnd; i++) {
                    dates.push(day.add(i, 'day'))
                }

                return dates
            },

            schedule: function () {

                const list = this.dates.map(date => {

                    const daysMeals = meals.filter(x => x.date == date.format('YYYY-MM-DD'))
                    const breakfasts = daysMeals.filter(x => x.mealtime == 'Breakfast')
                    const lunches = daysMeals.filter(x => x.mealtime == 'Lunch')
                    const dinners = daysMeals.filter(x => x.mealtime == 'Dinner')

                    return {
                        date: date.format('dddd D MMMM'),
                        dateForForm: date.format('YYYY-MM-DD'),
                        meals: daysMeals,
                        breakfasts: breakfasts,
                        lunches: lunches,
                        dinners: dinners
                    }
                })
                console.log(list)
                return list
            }


        }
    });
</script>

{% endblock %}